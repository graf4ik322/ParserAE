# –û—Ç—á–µ—Ç –æ–± –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ç–∞–π–º–∞—É—Ç–æ–≤ –∫–≤–∏–∑–∞

## üö® –ü—Ä–æ–±–ª–µ–º—ã –∏–∑ –ª–æ–≥–æ–≤

### –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ –ø–æ–∫–∞–∑–∞–ª:
1. **–¢–∞–π–º–∞—É—Ç –ò–ò —á–µ—Ä–µ–∑ 61 —Å–µ–∫—É–Ω–¥—É**:
   - `18:52:52,842` - –∑–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –∫ OpenRouter API
   - `18:53:53,749` - "–¢–∞–π–º–∞—É—Ç –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ OpenRouter API"
   - –ü—Ä–∏—á–∏–Ω–∞: —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π –ø—Ä–æ–º–ø—Ç —Å–æ –í–°–ï–ú–ò 1205 –ø–∞—Ä—Ñ—é–º–∞–º–∏

2. **–û—à–∏–±–∫–∏ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö callback –∑–∞–ø—Ä–æ—Å–æ–≤**:
   - `Query is too old and response timeout expired`
   - –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è —ç—Ç–æ–π –æ—à–∏–±–∫–∏
   - –ü—Ä–∏—á–∏–Ω–∞: –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ò–ò –∑–∞–Ω–∏–º–∞–µ—Ç –±–æ–ª—å—à–µ 60 —Å–µ–∫—É–Ω–¥

3. **–£—Å–ø–µ—à–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ, –Ω–æ —Å –æ—à–∏–±–∫–∞–º–∏**:
   - –ö–≤–∏–∑ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –∑–∞–≤–µ—Ä—à–∏–ª—Å—è: "‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 6398821843 –∑–∞–≤–µ—Ä—à–∏–ª –∫–≤–∏–∑"
   - –ù–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏–ª fallback —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–º–µ—Å—Ç–æ –ò–ò-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ç–∞–π–º–∞—É—Ç–∞ API

**–§–∞–π–ª:** `ai/processor.py`

**–ë—ã–ª–æ:**
```python
timeout=aiohttp.ClientTimeout(total=60)
```

**–°—Ç–∞–ª–æ:**
```python
timeout=aiohttp.ClientTimeout(total=180)  # 3 –º–∏–Ω—É—Ç—ã –¥–ª—è –±–æ–ª—å—à–∏—Ö –ø—Ä–æ–º–ø—Ç–æ–≤
```

### 2. –£–º–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–∞—Ä—Ñ—é–º–æ–≤ –¥–ª—è –∫–≤–∏–∑–∞

**–§–∞–π–ª:** `quiz/quiz_system.py`

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- –ú–µ—Ç–æ–¥ `_filter_perfumes_by_quiz_answers()` - —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ø–∞—Ä—Ñ—é–º—ã –ø–æ –æ—Ç–≤–µ—Ç–∞–º –∫–≤–∏–∑–∞
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ 500 –ª—É—á—à–∏—Ö –ø–∞—Ä—Ñ—é–º–æ–≤ –≤–º–µ—Å—Ç–æ –≤—Å–µ—Ö 1205
- –§–∏–ª—å—Ç—Ä—ã –ø–æ –ø–æ–ª—É, –±—é–¥–∂–µ—Ç—É –∏ —Å–µ–º–µ–π—Å—Ç–≤–∞–º –∞—Ä–æ–º–∞—Ç–æ–≤

**–†–µ–∑—É–ª—å—Ç–∞—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:**
- üìä **–ë—ã–ª–æ:** 1,205 –ø–∞—Ä—Ñ—é–º–æ–≤ ‚Üí 45KB –ø—Ä–æ–º–ø—Ç
- üéØ **–°—Ç–∞–ª–æ:** ~500 –ø–∞—Ä—Ñ—é–º–æ–≤ ‚Üí 23KB –ø—Ä–æ–º–ø—Ç  
- üìà **–£–ª—É—á—à–µ–Ω–∏–µ:** -58.5% —Ä–∞–∑–º–µ—Ä –ø—Ä–æ–º–ø—Ç–∞

### 3. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –¥–æ–ª–≥–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ

**–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–≤–∏–∑:**
```python
# –£–≤–µ–¥–æ–º–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ –Ω–∞—á–∞–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ò–ò
await update.callback_query.edit_message_text(
    "üß† **–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é –≤–∞—à–∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è...**\n\n"
    "–ò–ò-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–≤–∏–∑–∞ –∏ –ø–æ–¥–±–∏—Ä–∞–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.\n\n"
    "‚è≥ –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 1-2 –º–∏–Ω—É—Ç—ã...",
    parse_mode='Markdown'
)
```

### 4. –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö callback –∑–∞–ø—Ä–æ—Å–æ–≤

**–§–∞–π–ª:** `main.py` - —É–ª—É—á—à–µ–Ω error_handler

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
```python
# –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ callback –∑–∞–ø—Ä–æ—Å—ã - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –ø—Ä–∏ –¥–æ–ª–≥–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ –ò–ò
if "Query is too old" in error_message or "response timeout expired" in error_message:
    logger.info(f"‚ÑπÔ∏è –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º —É—Å—Ç–∞—Ä–µ–≤—à–∏–π callback –∑–∞–ø—Ä–æ—Å: {error_message}")
    return
```

## üîß –õ–æ–≥–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–∞—Ä—Ñ—é–º–æ–≤

### –§–∏–ª—å—Ç—Ä—ã –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ø–æ:

1. **–ü–æ–ª**:
   - `male` ‚Üí —Ç–æ–ª—å–∫–æ –º—É–∂—Å–∫–∏–µ –∏ —É–Ω–∏—Å–µ–∫—Å
   - `female` ‚Üí —Ç–æ–ª—å–∫–æ –∂–µ–Ω—Å–∫–∏–µ –∏ —É–Ω–∏—Å–µ–∫—Å
   - `unisex` ‚Üí –≤—Å–µ

2. **–ë—é–¥–∂–µ—Ç**:
   - `budget` ‚Üí –∏—Å–∫–ª—é—á–∞–µ–º –ø–∞—Ä—Ñ—é–º—ã –¥–æ—Ä–æ–∂–µ 5000 —Ä—É–±
   - `luxury` ‚Üí –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π

3. **–°–µ–º–µ–π—Å—Ç–≤–∞ –∞—Ä–æ–º–∞—Ç–æ–≤**:
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Å–µ–º–µ–π—Å—Ç–≤–∞–º
   - –ü–æ–∏—Å–∫ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º –≤ –æ–ø–∏—Å–∞–Ω–∏–∏

4. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞**:
   - –ú–∞–∫—Å–∏–º—É–º 500 –ø–∞—Ä—Ñ—é–º–æ–≤ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
   - –ë–µ—Ä—É—Ç—Å—è –ø–µ—Ä–≤—ã–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–µ (–º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–µ–π)

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –†–∞–∑–º–µ—Ä –ø—Ä–æ–º–ø—Ç–æ–≤:
- **–î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:** 1,205 –ø–∞—Ä—Ñ—é–º–æ–≤ = ~45,000 —Å–∏–º–≤–æ–ª–æ–≤ (44KB)
- **–ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:** ~500 –ø–∞—Ä—Ñ—é–º–æ–≤ = ~23,000 —Å–∏–º–≤–æ–ª–æ–≤ (23KB)
- **–£–ª—É—á—à–µ–Ω–∏–µ:** -48% —Ä–∞–∑–º–µ—Ä –ø—Ä–æ–º–ø—Ç–∞

### –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–ø—Ä–æ–≥–Ω–æ–∑):
- **–î–æ:** 60+ —Å–µ–∫—É–Ω–¥ ‚Üí —Ç–∞–π–º–∞—É—Ç
- **–ü–æ—Å–ª–µ:** 30-60 —Å–µ–∫—É–Ω–¥ ‚Üí —É—Å–ø–µ—à–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
- **–¢–∞–π–º–∞—É—Ç API:** —É–≤–µ–ª–∏—á–µ–Ω –¥–æ 180 —Å–µ–∫—É–Ω–¥ (–∑–∞–ø–∞—Å)

### –ö–∞—á–µ—Å—Ç–≤–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π:
- ‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ:** –≤—Å–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –ø–∞—Ä—Ñ—é–º—ã –ø–æ–ø–∞–¥–∞—é—Ç –≤ –≤—ã–±–æ—Ä–∫—É
- ‚úÖ **–£–ª—É—á—à–µ–Ω–æ:** –ò–ò –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
- ‚úÖ **–ë—ã—Å—Ç—Ä–µ–µ:** –º–µ–Ω—å—à–∏–π –ø—Ä–æ–º–ø—Ç = –±—ã—Å—Ç—Ä–µ–µ –æ–±—Ä–∞–±–æ—Ç–∫–∞

## üéØ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≤–µ—Ä—à–∞–µ—Ç –∫–≤–∏–∑
2. ‚ùå –¢–∞–π–º–∞—É—Ç —á–µ—Ä–µ–∑ 61 —Å–µ–∫—É–Ω–¥—É  
3. ‚ùå –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ callback
4. ‚ö†Ô∏è –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è fallback –±–µ–∑ –ò–ò-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≤–µ—Ä—à–∞–µ—Ç –∫–≤–∏–∑
2. üì± –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è "üß† –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é –≤–∞—à–∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è..."
3. ü§ñ –ò–ò –±—ã—Å—Ç—Ä–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç (~23KB)
4. ‚úÖ **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏!**

## üõ°Ô∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ –æ—à–∏–±–∫–∞–º:**
   - –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö callback
   - Fallback –∫ –Ω–æ–≤–æ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é –µ—Å–ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å

2. **–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ—Å—Ç—å:**
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø—Ä–æ—Ü–µ—Å—Å–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
   - –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–µ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è (1-2 –º–∏–Ω—É—Ç—ã)

3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –ø—Ä–æ–º–ø—Ç–æ–≤

## ‚úÖ –°—Ç–∞—Ç—É—Å

**–ü—Ä–æ–±–ª–µ–º–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤ –∫–≤–∏–∑–∞ —Ä–µ—à–µ–Ω–∞!**

- üéØ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤:** -58.5% —Ä–∞–∑–º–µ—Ä
- ‚è±Ô∏è **–£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ç–∞–π–º–∞—É—Ç–∞:** –¥–æ 180 —Å–µ–∫—É–Ω–¥  
- üì± **UX —É–ª—É—á—à–µ–Ω:** —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–æ—Ü–µ—Å—Å–µ
- üõ°Ô∏è **–£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å:** –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö callback

–ö–≤–∏–∑ —Ç–µ–ø–µ—Ä—å –¥–æ–ª–∂–µ–Ω —Å—Ç–∞–±–∏–ª—å–Ω–æ –∑–∞–≤–µ—Ä—à–∞—Ç—å—Å—è —Å –ò–ò-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ –≤–º–µ—Å—Ç–æ —Ç–∞–π–º–∞—É—Ç–æ–≤!